<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monitor de Unidades - Cubicaje (Ãºnico archivo)</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280;--ok:#16a34a;--warn:#f59e0b;--grey:#9ca3af}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#111;position:relative;min-height:100vh}

    /* Imagen de fondo en capa baja (visibilidad atenuada + movimiento suave) */
    body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;background-image:url('https://www.romacarabs.com/wp-content/uploads/2024/05/Llantas-de-un-coche.jpg');background-size:cover;background-position:45% 50%;background-repeat:no-repeat;opacity:0.55;filter:brightness(0.85) contrast(1.05) saturate(1.0);transform:scale(1);animation:bgPan 24s ease-in-out infinite}

    @keyframes bgPan{
      0%{transform:scale(1);background-position:40% 50%}
      50%{transform:scale(1.03);background-position:60% 50%}
      100%{transform:scale(1);background-position:40% 50%}
    }

    /* Header en verde claro para buena legibilidad */
    header{background:#2fa86e;color:#fff;padding:1rem 1rem;display:flex;align-items:center;justify-content:space-between;position:relative;z-index:3;box-shadow:0 2px 6px rgba(0,0,0,0.12)}
    header h1{margin:0;font-size:1.1rem;color:#000;font-weight:700}
    #today{color:#000}
    .controls{display:flex;gap:.5rem;align-items:center}
    input,select,button{padding:.45rem .6rem;border-radius:.375rem;border:1px solid #d1d5db}
    button{background:#111827;color:#fff;border:none}
    main{padding:1rem}
    .status{margin-bottom:1rem;color:var(--muted)}

    /* Make table text darker and headers stronger for better contrast */
    table{width:100%;border-collapse:collapse;background:transparent}
    th,td{padding:.6rem .75rem;border-bottom:1px solid #eef2f7;text-align:left;font-size:.95rem;color:#0b1220}
    th{background:#ffffff;color:#0b1220;font-weight:700}

    td.small{width:110px}
    .state{font-weight:600}
    .state.confirmed{color:var(--ok)}
    .state.pending{color:var(--warn)}
    .state.available{color:var(--grey)}
    .legend{margin-top:.5rem;color:var(--muted);font-size:.9rem}
    details .desc-list{margin:0.4rem 0 0 0;padding-left:1.05rem;max-height:160px;overflow:auto;font-size:.9rem;color:#111}
    details summary{cursor:pointer;font-weight:600;list-style:none}
    details summary::marker{display:none}
    details summary::after{content:'â–¾';float:right;font-weight:700}
    details[open] summary::after{content:'â–´'}
    /* Branding in header */
    .brand{font-weight:700;display:inline-flex;align-items:center;gap:12px;color:#000}
    .brand-logo{height:34px; width:auto; opacity:0.95; vertical-align:middle}
    .status-msg{font-size:0.85rem;color:var(--muted); margin-left:.6rem}

    /* Card that wraps the table to keep content readable over background */
    .card{background:rgba(255,255,255,1);padding:1rem;border-radius:12px;box-shadow:0 10px 30px rgba(15,23,42,0.18);position:relative;z-index:4;margin:1rem 0;border:1px solid rgba(0,0,0,0.04)}
    .table-wrap{overflow:auto}

    footer{padding:1rem;color:var(--muted);font-size:.85rem} 
    @media (max-width:800px){table,thead,tbody,th,td,tr{display:block}thead{display:none}td{border:none;border-bottom:1px solid #eee;padding:.6rem}td::before{content:attr(data-label);font-weight:600;display:block;margin-bottom:.3rem}}
  </style>
</head>
<body>
  <header>
    <h1>Estatus de las unidades <span id="today" style="font-weight:600;font-size:0.95rem;margin-left:.6rem;color:#cbd5e1"></span></h1>
    <div class="controls">
      <div id="status" class="status">Cargando datos...</div>
    </div>
  </header>

  <main>

    <div class="card">
      <div class="table-wrap">
        <table id="units" class="units">
          <thead>
            <tr>
              <th>Unidad</th>
              <th>EconÃ³mico</th>
              <th>Nombre</th>
              <th>Llantas</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  
  <script>
    // Normaliza nombres de campos para buscar valores independientemente de acentos/espacios
    const norm = k => (k||'').toString().trim().toLowerCase().replace(/\s+/g,'_').replace(/[()]/g,'').replace(/[^a-z0-9_]/g,'');

    function getField(obj, targets){
      for(const t of targets){
        // check direct
        if (t in obj && obj[t] !== undefined && obj[t] !== null && String(obj[t]).trim() !== '') return obj[t];
        // check normalized keys
        for(const k of Object.keys(obj)){
          if (norm(k) === t && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== '') return obj[k];
        }
      }
      return '';
    }

    function renderUnits(units){
      const tbody = document.querySelector('#units tbody');
      const card = document.querySelector('.card');
      tbody.innerHTML = '';
      if (!units || units.length === 0){
        // Oculta la tarjeta/tabla cuando no hay datos (no mostrar filas ni mensaje)
        if (card) card.style.display = 'none';
        return;
      }
      // Asegura que la tarjeta estÃ© visible cuando hay datos
      if (card) card.style.display = '';

      for(const u of units){
        const unidad = u.unidad || getField(u, ['unidad','Unidad','unidad']);
        const economico = (u.economico !== undefined) ? u.economico : getField(u, ['economico','econÃ³mico','EconÃ³mico']);
        const nombreList = u.nombreList || (getField(u,['nombre','Nombre']) ? [getField(u,['nombre','Nombre'])] : []);
        const details = u.details || [];
        const llantasTotal = (typeof u.llantas !== 'undefined') ? u.llantas : (parseFloat(getField(u,['llantas','Llantas'])) || 0);
        const state = (u.state || u.estado || '').toString().toLowerCase() || 'available';

        // Construir HTML para Nombre: si hay varios nombres, mostrar lista desplegable con cada nombre y su cantidad de llantas
        let nameHTML = '';
        if (nombreList.length > 1){
          const listItems = (details.length ? details : nombreList.map(n => ({nombre:n, llantasNum:''}))).map(it => `<li>${it.nombre}${it.llantasNum? ' â€” '+it.llantasNum : ''}</li>`).join('');
          nameHTML = `<details><summary>Ver nombres (${nombreList.length})</summary><ul class="desc-list">${listItems}</ul></details>`;
        } else {
          nameHTML = nombreList[0] || '';
        }

        const llDisplay = Number.isFinite(Number(llantasTotal)) ? (Number(llantasTotal) % 1 === 0 ? String(llantasTotal) : Number(llantasTotal).toFixed(2)) : (llantasTotal || '');

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="Unidad">${unidad}</td>
          <td data-label="EconÃ³mico">${economico}</td>
          <td data-label="Nombre">${nameHTML}</td>
          <td data-label="Llantas">${llDisplay}</td>
          <td data-label="Estado" class="state ${state}">${state==='confirmed'?'ðŸŸ¢ Confirmado':state==='pending'?'ðŸŸ¡ Pendiente':'âšª Disponible'}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    // Config (editable y guardada en localStorage)
    let SHEETDB_ID = localStorage.getItem('sheetdb_id') || 'he6n1zuoqus5b';
    let USE_SHEETDB = (localStorage.getItem('use_sheetdb') || '1') !== '0';

    /* Sin datos embebidos (mocks) en el cÃ³digo â€” en producciÃ³n no se usan unidades predeterminadas.
       Si no hay fuente externa, la tabla permanecerÃ¡ oculta y el estado mostrarÃ¡ un mensaje. */


    /* Config UI removed: using stored defaults (SHEETDB_ID and USE_SHEETDB) */

    async function fetchSheetDB(sheetName){
      try{
        const url = `https://sheetdb.io/api/v1/${SHEETDB_ID}?sheet=${encodeURIComponent(sheetName)}`;
        const r = await fetch(url);
        if (!r.ok) throw new Error(`SheetDB ${r.status}`);
        const json = await r.json();
        if (!Array.isArray(json)) return [];
        return json;
      }catch(e){
        console.warn('SheetDB fetch failed for', sheetName, e);
        return null; // indica fallo
      }
    }

    function arrayValuesToObjects(rows){
      // no usado en SheetDB mode, mantenido por compatibilidad
      return rows;
    }

    function processAndRender(pendRows, apartRows, sourceLabel){
      // Mapear por Unidad y agregar entradas duplicadas: sumar llantas y colectar nombres
      const map = new Map();

      function addRowToMap(r, state){
        const id = (getField(r,['unidad','Unidad'])||'').toString().trim();
        if (!id) return;
        const nombre = (getField(r,['nombre','Nombre'])||'').toString().trim();
        const llRaw = (getField(r,['llantas','Llantas'])||'0').toString();
        const llantasNum = parseFloat(llRaw.replace(/[^0-9\.-]/g,'')) || 0;

        const entry = { nombre, llantasNum };

        if (!map.has(id)){
          map.set(id, {
            unidad: id,
            economico: getField(r,['economico','econÃ³mico','EconÃ³mico']) || '',
            nombreList: nombre ? [nombre] : [],
            llantas: llantasNum,
            details: nombre ? [entry] : [],
            state: state
          });
          return;
        }

        const cur = map.get(id);
        // conservar economico si ya existe, si no tomar el nuevo
        if (!cur.economico) cur.economico = getField(r,['economico','econÃ³mico','EconÃ³mico']) || '';
        if (nombre) cur.nombreList.push(nombre);
        cur.llantas = (parseFloat(cur.llantas)||0) + llantasNum;
        if (nombre) cur.details.push(entry);
        // si aparece un confirmado, marcar como confirmado
        if (state === 'confirmed') cur.state = 'confirmed';
      }

      (pendRows||[]).forEach(r => addRowToMap(r, 'pending'));
      (apartRows||[]).forEach(r => addRowToMap(r, 'confirmed'));

      // Normalizar lista de nombres (eliminar duplicados)
      const units = Array.from(map.values()).map(u => ({
        ...u,
        nombreList: Array.from(new Set(u.nombreList))
      }));

      renderUnits(units);
      setBrandStatus(sourceLabel === 'sheetdb' ? '' : sourceLabel);
    }

    async function load(){
      setBrandStatus('Cargando...');
      try{
        if (USE_SHEETDB && SHEETDB_ID){
          const [pRows, aRows] = await Promise.all([
            fetchSheetDB('camiones pendientes'),
            fetchSheetDB('Apartados')
          ]);

          if (pRows === null && aRows === null){
            // No data available: do not use mocks; hide table
            processAndRender([], [], 'none');
            setBrandStatus('No se pudieron obtener datos (SheetDB fallÃ³)');
            return;
          }

          processAndRender(pRows||[], aRows||[], 'sheetdb');
          return;
        }

        // Si no usar SheetDB, no usar mocks â€” mostrar sin datos
        processAndRender([], [], 'none');
        setBrandStatus('No se estÃ¡n usando fuentes externas (sin datos)');
      }catch(e){
        console.error(e);
        setBrandStatus('Error cargando datos: '+ (e.message||e));
      }
    }

    

    function setBrandStatus(detailMessage){
      const statusEl = document.getElementById('status');
      if (!statusEl) return;
      // Embedded PNG (base64) logo provided by user - always available
      const logoSrc = 'data:image/png;base64,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';
      const msg = detailMessage ? `<span class="status-msg">${detailMessage}</span>` : '';
      statusEl.innerHTML = `<span class="brand">TRES SIGLOS <img src="${logoSrc}" alt="TRES SIGLOS" class="brand-logo"/></span>${msg}`;
    }

    // Set header date and initial load
    function setTodayDate(){
      const el = document.getElementById('today');
      if (!el) return;
      const d = new Date();
      el.textContent = d.toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // carga inicial
    setTodayDate();
    load();
  </script>
</body>
</html>
